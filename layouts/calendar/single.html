{{ define "main" }}
  <main class="post h-entry">
    {{ $timing := index .Params.timings 0 -}}
    {{ range .Params.timings -}}
      {{ if (time.AsTime .starts).Before time.Now -}}
        {{ $timing = . -}}
      {{ end -}}
    {{ end -}}

    <article>
      <hgroup class="post-title">
        <h1 class="p-name">
          {{ with .Params.emoji }}<span data-emoji="{{.}}"></span>{{end}}
          <a href="{{ .Permalink }}" class="noaccent u-url">{{ .Title | markdownify }}</a>
        </h1>
      </hgroup>

      {{ with .Summary }}
        <div class="post-summary p-summary" aria-hidden="true">{{ . }}</div>
      {{ end }}

      {{ if .Params.Cover }}
        <figure class="post-cover">
          <img src="{{ .Params.Cover | absURL }}" alt="{{ .Title }}" />
          
          {{ if .Params.CoverCaption }}
            <figcaption class="center">{{ .Params.CoverCaption | markdownify }}</figcaption>
          {{ end }}
        </figure>
      {{ end }}

      <div class="post-content e-content" data-pagefind-body data-pagefind-filter="type:{{.Type | title}}">
        {{ .Content }}
      </div>
    </article>

    <hr />

    <div class="post-info">
      {{ partial "tags.html" .Params.tags }}

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        On {{ partial "year-relative-date.html" (time.AsTime $timing.starts) }}
      </p>
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        {{ $starts := time.AsTime $timing.starts }}
        {{ $duration := time.ParseDuration ((strings.Substr $timing.duration 2) | strings.ToLower) }}
        From {{ $starts.Format "15:04" }} until {{ $starts.Add $duration | dateFormat "15:04 (MST)" }}
      </p>
        
      {{ if .Params.attending }}
      <p class="attending">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user-check"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><polyline points="17 11 19 13 23 9"></polyline></svg>
        {{ if eq .Params.attending true }}{{ partial "friend.html" "jp.no-emoji" }} is going
        {{ else if eq (len .Params.attending) 1 }}
          {{ partial "friend.html" (printf "%s.no-emoji" (index .Params.attending 0)) }} is going
        {{ else }}
          {{ $count := len .Params.attending}}
          {{ range $i, $attendee := .Params.attending }}
            {{ partial "friend.html" (printf "%s.no-emoji" $attendee) -}}
            {{- if eq $i (sub $count 2) }}{{ if gt $count 2 }},{{ end }} and {{ else if lt $i (sub $count 1) }}, {{ end }}
          {{ end }} are going
        {{ end }}
      </p>
      {{ end }}

    </div>

    <hr />
    <div class="syndication">
      {{ partial "syndication.html" . }}
    </div>

    {{ partial "pagination-single.html" . }}
  </main>
{{ end }}
